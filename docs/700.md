# üöÄ PLANO DE A√á√ÉO: N√çVEL 700 - A BARBEARIA AUT√îNOMA

Este plano detalha o salto final do Barber do N√≠vel 360/400 diretamente para o **N√≠vel 700+ (Enlightenment Tier)**, inspirado no Roadmap Hawkins.

> **O CONCEITO CHAVE DO N√çVEL 700:**
> O sistema √© mais simples que o problema. A conversa te encontra, n√£o voc√™ a ela. O Frontend React torna-se quase descart√°vel para a opera√ß√£o di√°ria. O Barbeiro/Admin n√£o gere mais o sistema; o sistema gere o Barbeiro.

---

## üõ†Ô∏è PASSO 1: INVERS√ÉO DE INICIATIVA (PROATIVIDADE)

### 1.1. O "Bom Dia" do Sistema (Daily Briefing)
O sistema deve acordar o barbeiro, n√£o o contr√°rio.
- **A√ß√£o:** Criar um Cron Trigger (Cloudflare Worker) rodando todo dia √†s 07:30.
- **L√≥gica:**
  1. Busca todos os agendamentos do dia atual para o barbeiro X.
  2. Identifica hor√°rios livres e a proje√ß√£o financeira (ex: "R$ 450 hoje").
  3. Formata um resumo sucinto usando o Llama 3.1.
  4. Dispara a mensagem via `wa-bridge` automaticamente para o WhatsApp do dono/barbeiro.
- **Resultado Esperado (WhatsApp):** *"Bom dia Celso! ‚úÇÔ∏è Voc√™ tem 6 agendamentos hoje (R$ 380). Primeiro cliente √†s 09:00 (Jo√£o). Voc√™ tem buracos √†s 11:00 e 15:00. O dia est√° pronto, bom trabalho!"*

### 1.2. Alertas de "Buraco na Agenda" (Auto-Gest√£o)
O sistema deve observar anomalias sem ningu√©m pedir.
- **A√ß√£o:** Um job de verifica√ß√£o rodando a cada certa quantidade de horas.
- **L√≥gica:** Se for sexta-feira e a agenda da tarde estiver com menos de 30% de ocupa√ß√£o (comparado ao hist√≥rico das √∫ltimas 3 sextas), o sistema manda mensagem ao barbeiro.
- **Resultado Esperado (WhatsApp):** *"Sua agenda est√° muito vazia sexta √† tarde. Quer que eu mande uma promo r√°pida pros seus √∫ltimos 20 clientes recorrentes?"* (Opcional: o barbeiro precisa apenas digitar "Sim").

---

## üí¨ PASSO 2: CONTROLE DO NEG√ìCIO VIA CONVERSA (FIM DO DASHBOARD)

O N√≠vel 700 exige que todas as a√ß√µes n√£o triviais ocorram na superf√≠cie escolhida: O WhatsApp. A necessidade de abrir uma URL Web ou um App para bloquear o pr√≥prio hor√°rio deve ser eliminada.

### 2.1. Comandos de Admin no Chat
- **A√ß√£o:** Expandir o webhook actual do WhatsApp (`whatsapp.js`) para reconhecer se o n√∫mero ou e-mail que est√° interagindo pertence a um `is_barber = 1` ou `is_admin = 1`.
- **L√≥gica:** Se a mensagem vier do dono e contiver inten√ß√µes claras de gest√£o, a IA detecta e executa a√ß√µes de banco de dados diretamente.
- **Funcionalidades a implementar via chat:**
  - *"Bloqueia minha agenda amanh√£ cedo at√© as 12h."* -> (A IA invoca a rota de bloquear blocos).
  - *"O Marcos (que marcou √†s 15h) acabou de chegar."* -> (Altera o status do agendamento de pendente para 'em andamento').
  - *"Cancela o √∫ltimo cara que marcou, preciso resolver um problema."* -> (Cancela e avisa o cliente no fundo).

### 2.2. Confirma√ß√µes de Pagamento H√≠bridas (Sem Frontend Web)
- **A√ß√£o:** Permitir for√ßar confirma√ß√£o sem tocar no Mouse.
- **L√≥gica:** Se algu√©m fez um agendamento e o webhook do MP diz que falhou, mas na maquineta f√≠sica o cliente pagou e falou com o barbeiro, o barbeiro manda pro Bot: *"Libera o pagamento do Jo√£o"* e pronto.

---

## üóëÔ∏è PASSO 3: O C√ìDIGO QUE SOBREVIVE E O QUE DESCARTAMOS

O maior inimigo √© o c√≥digo acumulado. O N√≠vel 700 requer a remo√ß√£o daquilo que foi criado para remediar problemas e n√£o focar na ess√™ncia.

### 3.1. Destrui√ß√£o Sistem√°tica de "Muletas" no Frontend (React)
- Remover os pop-ups complicados de edi√ß√£o t√©cnica de hor√°rios conflitantes. A IA do Bot j√° impede duplica√ß√£o e conversa com o cliente caso o hor√°rio saia da r√©gua.
- Transformar 90% das telas React em **visualiza√ß√£o (Read-Only)**.
- **Delet√°vel:** Rotas de altera√ß√£o de estado manuais desnecess√°rias (exemplo: bot√µes de simular erro em fila, menus complexos de aprova√ß√£o a dois passos). A confirma√ß√£o do agendamento deve focar em Pagamentos MP ou Confirma√ß√µes Autom√°ticas via Zap.

### 3.2. Sobreviv√™ncia (O Dom√≠nio Aut√™ntico)
- A l√≥gica de persist√™ncia e `whatsapp.js`.
- A separa√ß√£o entre Llama e Banco (O core do neg√≥cio hoje).
- A API do Mercado Pago (vital√≠cio e simples).

---

## üìÖ TIMELINE RESUMIDO DO C√ìDIGO DO "SALTO"

1. **Semana 1:** Configurar Cron do Cloudflare (`wrangler.toml` triggers) para testes de "Daily Briefing".
2. **Semana 2:** Esculturar a Identidade "Admin" no Webhook do WhatsApp. Criar 2 inten√ß√µes fortes: Bloquear/Abrir agenda; Ler resumo da agenda do dia pedindo diretamente ao bot.
3. **Semana 3:** Limpeza das funcionalidades no App Frontend de React, migrando a depend√™ncia da tela para a depend√™ncia das notifica√ß√µes de celular (Bridge).

> *Sinal de sucesso oficial do N√≠vel 700: Um dia inteiro onde o barbeiro trabalha usando o Barber, faz X cortes, entra receita e ele n√£o loga nenhuma vez pelo notebook, abrindo apenas o celular quando o bot fala.*
